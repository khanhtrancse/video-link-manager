<!DOCTYPE html>
<html>

<head>
  <title>
    Register
  </title>
  <% include ../partials/head.ejs %>
</head>

<body class="background">
  <div class="container">
    <div class="row">
      <div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
        <div class="card card-signin my-5">
          <div class="card-body">
            <h5 class="card-title text-center">Register</h5>

            <form id="register-form" enctype="application/x-www-form-urlencoded" class="form-signin" method="POST"
              onsubmit="return validateRegisterForm()"
              action="/register">
              <div class="form-group">
                <label for="username">Username</label>
                <input type="text" name="username" id="username" 
                class="form-control" placeholder="Username" value="<%=user.username%>">
                <small id="username-error" class="text-danger text-small"></small>
              </div>

              <div class="form-group">
                <label for="email">Email address</label>
                <input type="text" name="email" id="email" class="form-control" placeholder="Email address"
                value="<%=user.email%>">
                <small id="email-error" class="text-danger text-small"><%=error.email%></small>
              </div>

              <div class="form-group">
                <label for="password">Password</label>
                <input type="password" name="password" id="password" class="form-control" placeholder="Password">
                <small id="password-error" class="text-danger text-small"></small>
              </div>

              <div class="form-group">
                <label for="confirm-password">Confirm Password</label>
                <input type="password" name="confirm-password" id="confirm-password" class="form-control" placeholder="Confirm Password">
                <small id="confirm-password-error" class="text-danger text-small"></small>
              </div>

              <div class="d-flex row justify-content-center">
                <input class="btn btn-primary" type="submit" value="Register"/>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<script>
  function validateRegisterForm() {
    const email = $('#email').val();
    const name = $('#username').val();
    const password = $('#password').val();
    const confirmPass = $('#confirm-password').val();
    let hasError = false;

    let message='';
    if(!name || name.length < 3){
      message='Username must be at least 3 characters';
      hasError = true;
    } else{
      message = '';
    }
    $("#username-error").html(message);

    if(!email || email == '' || email.length < 3 || email.split('@').length != 2){
      message='Email is invalid';
      hasError = true;
    } else{
      message = '';
    }
    $("#email-error").html(message);

    if(!password || password.length < 6){
      message='Password must be at least 6 characters';
      hasError = true;
    } else{
      message = '';
    }
    $("#password-error").html(message);

    if(confirmPass != password){
      message='Confirm password is not correct';
      hasError = true;
    } else{
      message = '';
    }
    $("#confirm-password-error").html(message);

    return !hasError;
  }
</script>

</html>